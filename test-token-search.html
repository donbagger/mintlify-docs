<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Search Test - DexPaprika</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #16A34A;
            margin-bottom: 24px;
        }
        .search-section {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
        }
        .search-input-group {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
        }
        .search-input:focus {
            outline: none;
            border-color: #16A34A;
        }
        .search-button {
            padding: 12px 24px;
            background: #16A34A;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        .search-button:hover {
            background: #15803D;
        }
        .results-section {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
        }
        .results-header {
            background: #f8fafc;
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
        }
        .results-table th {
            background: #f8fafc;
            padding: 16px 20px;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid #e2e8f0;
        }
        .results-table td {
            padding: 16px 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        .network-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .network-ethereum { background: #627eea; color: white; }
        .network-solana { background: #9945ff; color: white; }
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        .no-results {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Token Coverage Checker</h1>
        
        <div class="search-section">
            <div class="search-input-group">
                <input 
                    type="text" 
                    id="token-search-input" 
                    placeholder="Enter token symbol (e.g., SOL, USDC) or name"
                    class="search-input"
                />
                <button id="search-button" class="search-button">
                    üîç Search
                </button>
            </div>
            
            <div class="search-tips">
                <p><strong>üí° Try searching for:</strong></p>
                <ul>
                    <li><code>SOL</code> - Solana</li>
                    <li><code>USDC</code> - USD Coin</li>
                    <li><code>WETH</code> - Wrapped Ether</li>
                    <li><code>BONK</code> - Bonk</li>
                </ul>
            </div>
        </div>

        <div id="search-results" class="results-section" style="display: none;">
            <div class="results-header">
                <h3 id="results-title">Search Results</h3>
                <p id="results-subtitle"></p>
            </div>
            
            <div id="loading-spinner" class="loading" style="display: none;">
                <div>‚è≥ Searching for tokens...</div>
            </div>
            
            <div id="results-table-container">
                <table id="results-table" class="results-table">
                    <thead>
                        <tr>
                            <th>Token</th>
                            <th>Network</th>
                            <th>Address</th>
                            <th>Market Data</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="results-table-body">
                    </tbody>
                </table>
            </div>
            
            <div id="no-results" class="no-results" style="display: none;">
                <h4>‚ùå No tokens found</h4>
                <p>Try searching for a different term or check the spelling.</p>
            </div>
        </div>
    </div>

    <!-- Load the API integration script -->
    <script src="token-search-api.js"></script>
    
    <script>
        // DOM elements
        const searchInput = document.getElementById('token-search-input');
        const searchButton = document.getElementById('search-button');
        const searchResults = document.getElementById('search-results');
        const loadingSpinner = document.getElementById('loading-spinner');
        const resultsTableContainer = document.getElementById('results-table-container');
        const resultsTableBody = document.getElementById('results-table-body');
        const noResults = document.getElementById('no-results');
        const resultsTitle = document.getElementById('results-title');
        const resultsSubtitle = document.getElementById('results-subtitle');

        // Local search fallback function
        function searchTokensLocal(query) {
            const tokenDatabase = [
                {
                    symbol: "SOL",
                    name: "Solana",
                    chain: "solana",
                    address: "So11111111111111111111111111111111111111112",
                    available: true
                },
                {
                    symbol: "USDC",
                    name: "USD Coin",
                    chain: "ethereum",
                    address: "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
                    available: true
                },
                {
                    symbol: "USDC",
                    name: "USD Coin",
                    chain: "solana",
                    address: "Es9vMFrzaCER2kJ8U1L8vMcbA5sX6Phn7ZdZ2m5W861",
                    available: true
                },
                {
                    symbol: "WETH",
                    name: "Wrapped Ether",
                    chain: "ethereum",
                    address: "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",
                    available: true
                },
                {
                    symbol: "WBTC",
                    name: "Wrapped Bitcoin",
                    chain: "ethereum",
                    address: "0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599",
                    available: true
                },
                {
                    symbol: "BONK",
                    name: "Bonk",
                    chain: "solana",
                    address: "DezXAZ8z7P5M5VKsTR5VYg5t6sQf5CqZ3k8sEzsZsP1",
                    available: true
                },
                {
                    symbol: "USDT",
                    name: "Tether USD",
                    chain: "ethereum",
                    address: "0xdAC17F958D2ee523a2206206994597C13D831ec7",
                    available: true
                },
                {
                    symbol: "USDT",
                    name: "Tether USD",
                    chain: "solana",
                    address: "Es9vMFrzaCER2kJ8U1L8vMcbA5sX6Phn7ZdZ2m5W861",
                    available: true
                }
            ];

            if (!query || query.trim().length < 1) return [];
            
            const searchTerm = query.toLowerCase().trim();
            
            return tokenDatabase.filter(token => {
                return token.symbol.toLowerCase().includes(searchTerm) ||
                       token.name.toLowerCase().includes(searchTerm) ||
                       token.address.toLowerCase().includes(searchTerm);
            });
        }

        // Search function - uses real API with fallback
        async function searchTokens(query) {
            if (!query || query.trim().length < 1) return [];
            
            console.log('üîç Starting search for:', query);
            console.log('üîç window.tokenSearchAPI available:', !!window.tokenSearchAPI);
            
            try {
                // Try to use the real API first
                if (window.tokenSearchAPI) {
                    console.log('üåê Using API search...');
                    const results = await window.tokenSearchAPI.searchTokens(query);
                    console.log('‚úÖ API search returned:', results.length, 'results');
                    return results;
                } else {
                    console.log('‚ö†Ô∏è tokenSearchAPI not available');
                }
            } catch (error) {
                console.warn('‚ùå API search failed, using fallback:', error);
            }
            
            // Fallback to local search
            console.log('üîÑ Using local search fallback...');
            const localResults = searchTokensLocal(query);
            console.log('üì¶ Local search returned:', localResults.length, 'results');
            return localResults;
        }

        // Display results
        function displayResults(tokens, query) {
            searchResults.style.display = 'block';
            loadingSpinner.style.display = 'none';
            
            if (tokens.length === 0) {
                resultsTableContainer.style.display = 'none';
                noResults.style.display = 'block';
                resultsTitle.textContent = 'No Results Found';
                resultsSubtitle.textContent = `No tokens found matching "${query}"`;
                return;
            }
            
            resultsTableContainer.style.display = 'block';
            noResults.style.display = 'none';
            resultsTitle.textContent = `Found ${tokens.length} Token${tokens.length > 1 ? 's' : ''}`;
            resultsSubtitle.textContent = `Results for "${query}"`;
            
            // Clear previous results
            resultsTableBody.innerHTML = '';
            
            // Add results to table
            tokens.forEach(token => {
                const row = document.createElement('tr');
                
                const networkClass = `network-${token.chain}`;
                
                // Format price and volume if available
                const price = token.price ? `$${parseFloat(token.price).toFixed(6)}` : 'N/A';
                const volume = token.volume ? `$${parseFloat(token.volume).toLocaleString()}` : 'N/A';
                const liquidity = token.liquidity ? `$${parseFloat(token.liquidity).toLocaleString()}` : 'N/A';
                
                row.innerHTML = `
                    <td>
                        <div>
                            <strong style="color: #16A34A;">${token.symbol}</strong><br>
                            <small style="color: #6b7280;">${token.name}</small>
                        </div>
                    </td>
                    <td>
                        <span class="network-badge ${networkClass}">${token.chain}</span>
                    </td>
                    <td>
                        <code style="font-size: 12px; color: #6b7280;">${token.address}</code>
                    </td>
                    <td>
                        <div>
                            <div><strong>${price}</strong></div>
                            <div style="font-size: 12px; color: #6b7280;">24h Vol: ${volume}</div>
                            <div style="font-size: 11px; color: #6b7280;">Liquidity: ${liquidity}</div>
                        </div>
                    </td>
                    <td>
                        <button style="padding: 4px 8px; background: #16A34A; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">
                            View API
                        </button>
                    </td>
                `;
                
                resultsTableBody.appendChild(row);
            });
        }

        // Show loading state
        function showLoading() {
            searchResults.style.display = 'block';
            loadingSpinner.style.display = 'block';
            resultsTableContainer.style.display = 'none';
            noResults.style.display = 'none';
        }

        // Handle search
        async function handleSearch() {
            const query = searchInput.value.trim();
            
            if (!query) {
                alert('Please enter a search term');
                return;
            }
            
            showLoading();
            
            try {
                const results = await searchTokens(query);
                displayResults(results, query);
            } catch (error) {
                console.error('Search error:', error);
                displayResults([], query);
            }
        }

        // Event listeners
        searchButton.addEventListener('click', handleSearch);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleSearch();
            }
        });

        // Auto-focus search input
        searchInput.focus();
        
        console.log('Token search test page loaded successfully!');
    </script>
</body>
</html>
